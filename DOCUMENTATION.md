# Система Контроля Посещаемости Студентов (СКПС) - Документация

## Обзор проекта

СКПС (Student Attendance Control System) - это система контроля посещаемости студентов во время приемов пищи в учебном заведении. Система использует RFID-карты для идентификации студентов и позволяет отслеживать, кто из зарегистрированных студентов пришел на обед, завтрак или ужин.

### Основные возможности
- **Проверка посещаемости**: Проверка доступа студента к приему пищи по ID карты
- **Управление студентами**: Добавление, редактирование и удаление информации о студентах
- **Регистрация на приемы пищи**: Регистрация студентов на конкретные приемы пищи по дням недели
- **Отчеты о посещаемости**: Просмотр отчетов по посещаемости для конкретных приемов пищи или общих таблиц посещаемости
- **База данных SQLite**: Хранение всей информации в локальной базе данных

## Установка и настройка

### Требования
- Python 3.x
- SQLite3 (обычно включен в Python)

### Инициализация базы данных
1. Запустите скрипт инициализации базы данных:
   ```bash
   python db/init_db.py
   ```
   Это создаст файл `skud.db` с необходимыми таблицами и заполнит таблицу приемов пищи стандартными значениями (завтрак, обед, ужин для каждого дня недели).

### Структура проекта
```
skud_2.0/
├── main.py                 # Основной скрипт проверки посещаемости
├── manage_students.py      # Управление студентами
├── view_reports.py         # Просмотр отчетов
├── register_student.py     # Регистрация студентов на приемы пищи
├── add_student.py          # Добавление новых студентов
├── skud.db                 # База данных SQLite
├── db/
│   ├── init_db.py          # Инициализация базы данных
│   ├── student.py          # Функции работы со студентами
│   ├── meals.py            # Функции работы с приемами пищи
│   └── reports.py          # Функции генерации отчетов
└── DOCUMENTATION.md        # Эта документация
```

## Использование

### 1. Основная проверка посещаемости (main.py)
Этот скрипт является основным интерфейсом системы. Он проверяет, может ли студент поесть в текущий момент времени.

```bash
python main.py
```

**Алгоритм работы:**
1. Определяет текущий прием пищи на основе времени и дня недели
2. Запрашивает ID карты студента
3. Проверяет, зарегистрирован ли студент на текущий прием пищи
4. Если да - записывает факт посещения и разрешает проход
5. Если нет - отказывает в доступе

### 2. Управление студентами (manage_students.py)
Скрипт для просмотра, редактирования и удаления информации о студентах.

```bash
python manage_students.py
```

**Доступные действия:**
- Просмотр списка всех студентов (ID, имя, ID карты)
- Изменение имени или ID карты студента
- Удаление студента (вместе с регистрациями и записями посещаемости)

### 3. Просмотр отчетов (view_reports.py)
Скрипт для генерации различных отчетов о посещаемости.

```bash
python view_reports.py
```

**Типы отчетов:**
1. **Отчет по конкретному приему пищи**: Выберите день недели и конкретный прием пищи, чтобы увидеть кто пришел/не пришел
2. **Общая таблица посещаемости**: Таблица со статусом посещаемости всех студентов на все приемы пищи по дням недели

### 4. Регистрация студентов на приемы пищи (register_student.py)
Скрипт для регистрации существующих студентов на конкретные приемы пищи.

```bash
python register_student.py
```

**Процесс регистрации:**
1. Введите ID карты студента
2. Выберите день недели (или -1 для всех дней)
3. Выберите конкретные приемы пищи для регистрации

### 5. Добавление новых студентов (add_student.py)
Скрипт для добавления новых студентов в систему.

```bash
python add_student.py
```

**Требуемые данные:**
- Имя студента
- Уникальный ID карты

## Схема базы данных

### Таблица `students`
Хранит информацию о студентах.

| Поле    | Тип    | Описание          |
|---------|--------|-------------------|
| id      | INTEGER | Первичный ключ    |
| name    | TEXT   | Имя студента      |
| card_id | INTEGER| Уникальный ID карты|

### Таблица `meals`
Хранит информацию о приемах пищи.

| Поле       | Тип     | Описание                    |
|------------|---------|-----------------------------|
| id         | INTEGER | Первичный ключ              |
| name       | TEXT   | Название приема (Breakfast/Lunch/Dinner) |
| start_time | TEXT   | Время начала (HH:MM)        |
| end_time   | TEXT   | Время окончания (HH:MM)     |
| day_of_week| INTEGER| День недели (0=Пн, 6=Вс)    |

### Таблица `registrations`
Связывает студентов с приемами пищи, на которые они зарегистрированы.

| Поле       | Тип     | Описание              |
|------------|---------|-----------------------|
| id         | INTEGER | Первичный ключ        |
| student_id | INTEGER | Ссылка на студента    |
| meal_id    | INTEGER | Ссылка на прием пищи  |

### Таблица `attendance`
Хранит записи о фактической посещаемости.

| Поле       | Тип     | Описание                          |
|------------|---------|-----------------------------------|
| id         | INTEGER | Первичный ключ                    |
| student_id | INTEGER | Ссылка на студента                |
| meal_id    | INTEGER | Ссылка на прием пищи              |
| timestamp  | TEXT   | Время записи посещения            |
| status     | TEXT   | Статус ('came' или 'didnt_come')  |

## Описание модулей

### db/init_db.py
- `init_db()`: Создает и инициализирует базу данных с необходимыми таблицами
- Заполняет таблицу meals стандартными приемами пищи для всех дней недели

### db/student.py
- `finding_card(card_id)`: Находит ID студента по ID карты
- `check_student(card_id, meal_id)`: Проверяет, зарегистрирован ли студент на прием пищи
- `log_attendance(student_id, meal_id, status)`: Записывает факт посещения
- `add_student(name, card_id)`: Добавляет нового студента
- `add_registration(student_id, meal_id)`: Регистрирует студента на прием пищи
- `get_all_students()`: Возвращает список всех студентов
- `update_student(student_id, name, card_id)`: Обновляет информацию о студенте
- `delete_student(student_id)`: Удаляет студента и связанные записи

### db/meals.py
- `get_current_meal()`: Определяет текущий прием пищи на основе времени и дня недели
- `get_meal_name(meal_id)`: Возвращает название приема пищи по ID

### db/reports.py
- `get_attendance_report(meal_id, day_of_week)`: Генерирует отчет по посещаемости для конкретного приема пищи
- `get_all_attendance_records()`: Возвращает все записи о посещаемости для формирования общей таблицы

## Замечания по разработке

### Добавление новых функций
- Все операции с базой данных вынесены в отдельные модули в папке `db/`
- Для добавления новых типов отчетов модифицируйте `db/reports.py` и `view_reports.py`
- Для изменения логики проверки посещаемости редактируйте `main.py` и `db/student.py`

### Безопасность
- ID карт должны быть уникальными
- Включены внешние ключи для поддержания целостности данных
- Рекомендуется регулярное резервное копирование файла `skud.db`

### Расширение системы
Возможные улучшения:
- Веб-интерфейс для управления системой
- Интеграция с RFID-ридерами
- Экспорт отчетов в различные форматы (PDF, Excel)
- Уведомления о пропусках приемов пищи
- Статистика посещаемости по периодам
