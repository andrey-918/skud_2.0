# Система Контроля Посещаемости Студентов (СКПС) - Документация

## Обзор проекта

СКПС (Student Attendance Control System) - это система контроля посещаемости студентов во время приемов пищи в учебном заведении. Система использует RFID-карты для идентификации студентов и позволяет отслеживать, кто из зарегистрированных студентов пришел на обед, завтрак или ужин. Основной интерфейс реализован в виде графического приложения (GUI) на базе Tkinter, которое объединяет все функции в едином окне с вкладками. Консольные скрипты доступны как альтернативные инструменты для автоматизации или использования без GUI.

### Основные возможности
- **Графический интерфейс (GUI)**: Интегрированный интерфейс с вкладками для управления студентами, регистрацией, отчетами и проверкой посещаемости
- **Проверка посещаемости**: Проверка доступа студента к приему пищи по ID карты с автоматическим определением текущего приема
- **Управление студентами**: Добавление, редактирование и удаление информации о студентах, включая импорт из XLSX-файлов
- **Регистрация на приемы пищи**: Регистрация студентов на конкретные приемы пищи по дням недели с возможностью массового выбора
- **Отчеты о посещаемости**: Просмотр отчетов по посещаемости для конкретных приемов пищи или общих таблиц посещаемости с экспортом в текстовый формат
- **База данных SQLite**: Хранение всей информации в локальной базе данных
- **Импорт данных**: Поддержка импорта студентов и их регистраций из Excel-файлов (XLSX)

## Установка и настройка

### Требования
- Python 3.x
- SQLite3 (обычно включен в Python)
- pip (для установки зависимостей)

### Быстрая установка и запуск
Для быстрого развертывания на новом устройстве:
1. Скачайте или клонируйте проект.
2. Запустите лаунчер:
   ```bash
   python launcher.py
   ```
   Это автоматически установит необходимые зависимости (openpyxl), инициализирует базу данных и запустит GUI-приложение.

### Ручная установка зависимостей
Если предпочитаете ручную установку:
1. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
2. Инициализируйте базу данных:
   ```bash
   python db/init_db.py
   ```
   Это создаст файл `skud.db` с необходимыми таблицами и заполнит таблицу приемов пищи стандартными значениями (завтрак, обед, ужин для каждого дня недели).

### Структура проекта
```
skud_2.0/
├── launcher.py             # Лаунчер для автоматической установки и запуска
├── requirements.txt        # Список зависимостей для установки
├── gui.py                  # Основной GUI-интерфейс (Tkinter) с вкладками для всех функций
├── main.py                 # Консольный скрипт проверки посещаемости (альтернатива GUI)
├── manage_students.py      # Консольное управление студентами (альтернатива GUI)
├── view_reports.py         # Консольный просмотр отчетов (альтернатива GUI)
├── register_student.py     # Консольная регистрация студентов на приемы пищи (альтернатива GUI)
├── add_student.py          # Консольное добавление новых студентов (альтернатива GUI)
├── skud.db                 # База данных SQLite
├── db/
│   ├── init_db.py          # Инициализация базы данных
│   ├── student.py          # Функции работы со студентами
│   ├── meals.py            # Функции работы с приемами пищи
│   └── reports.py          # Функции генерации отчетов
└── DOCUMENTATION.md        # Эта документация
```

## Использование

### Запуск GUI-приложения
Основной способ взаимодействия с системой - через графический интерфейс:

```bash
python gui.py
```

Приложение откроет окно с четырьмя вкладками: "Управление студентами", "Регистрация на приемы пищи", "Отчеты" и "Проверка посещаемости". База данных инициализируется автоматически при запуске.

### Вкладка "Управление студентами"
Предназначена для просмотра, добавления, редактирования и удаления студентов.

**Функции:**
- **Просмотр списка**: Таблица со всеми студентами (ID, имя, ID карты). Кнопка "Обновить список" для перезагрузки данных.
- **Добавление студента**: Диалог для ввода имени и ID карты. Студент добавляется в базу.
- **Редактирование**: Выберите студента в таблице, нажмите "Изменить студента" для обновления имени или ID карты.
- **Удаление**: Выберите студента, подтвердите удаление (удаляет студента и все связанные записи).
- **Импорт из XLSX**: Выберите Excel-файл для импорта. Формат: начиная с строки 9, столбец 3 - имя студента, столбцы 4-22 - регистрации (по 3 столбца на день: понедельник-суббота, завтрак/обед/ужин, значение 1 для регистрации). Автоматически присваиваются новые ID карт.

### Вкладка "Регистрация на приемы пищи"
Для регистрации студентов на приемы пищи по дням.

**Процесс:**
1. Введите ID карты студента и нажмите "Найти студента" для поиска и отображения имени.
2. Выберите день: "Все дни" или конкретный день недели.
3. Нажмите "Загрузить приемы пищи" для отображения списка доступных приемов (завтрак, обед, ужин) для выбранного дня.
4. Выберите один или несколько приемов пищи в списке.
5. Нажмите "Зарегистрировать" для сохранения регистраций.

### Вкладка "Отчеты"
Для генерации отчетов о посещаемости.

**Типы отчетов:**
1. **Отчет по конкретному приему пищи**:
   - Выберите день недели и нажмите "Показать приемы пищи".
   - Выберите конкретный прием пищи из списка.
   - Нажмите "Сгенерировать отчет" для отображения списка "Пришли" и "Не пришли".
2. **Общая таблица посещаемости**:
   - Нажмите "Показать общую таблицу" для отображения сводной таблицы по дням, студентам и приемам пищи (статусы: "пришел", "не пришел", "не записан").

Результаты отображаются в текстовом поле вкладки.

### Вкладка "Проверка посещаемости"
Основная функция проверки доступа студентов.

**Работа:**
1. Автоматически определяет текущий прием пищи (на основе времени и дня недели). Кнопка "Обновить" для перерасчета.
2. Введите ID карты студента в поле.
3. Нажмите "Проверить доступ":
   - Если студент зарегистрирован на текущий прием - отображается "ДОСТУП РАЗРЕШЕН" (зеленый), факт посещения записывается.
   - Иначе - "ДОСТУП ЗАПРЕЩЕН" (красный).

### Консольные альтернативы
Для автоматизации или использования без GUI доступны консольные скрипты:
- `python main.py`: Проверка посещаемости (аналог вкладки "Проверка посещаемости").
- `python manage_students.py`: Управление студентами (аналог вкладки "Управление студентами", без импорта XLSX).
- `python view_reports.py`: Просмотр отчетов (аналог вкладки "Отчеты").
- `python register_student.py`: Регистрация на приемы пищи (аналог вкладки "Регистрация").
- `python add_student.py`: Добавление студентов (часть функций вкладки "Управление студентами").

## Схема базы данных

### Таблица `students`
Хранит информацию о студентах.

| Поле    | Тип    | Описание          |
|---------|--------|-------------------|
| id      | INTEGER | Первичный ключ    |
| name    | TEXT   | Имя студента      |
| card_id | TEXT| Уникальный ID карты|

### Таблица `meals`
Хранит информацию о приемах пищи.

| Поле       | Тип     | Описание                    |
|------------|---------|-----------------------------|
| id         | INTEGER | Первичный ключ              |
| name       | TEXT   | Название приема (Breakfast/Lunch/Dinner) |
| start_time | TEXT   | Время начала (HH:MM)        |
| end_time   | TEXT   | Время окончания (HH:MM)     |
| day_of_week| INTEGER| День недели (0=Пн, 6=Вс)    |

### Таблица `registrations`
Связывает студентов с приемами пищи, на которые они зарегистрированы.

| Поле       | Тип     | Описание              |
|------------|---------|-----------------------|
| id         | INTEGER | Первичный ключ        |
| student_id | INTEGER | Ссылка на студента    |
| meal_id    | INTEGER | Ссылка на прием пищи  |

### Таблица `attendance`
Хранит записи о фактической посещаемости.

| Поле       | Тип     | Описание                          |
|------------|---------|-----------------------------------|
| id         | INTEGER | Первичный ключ                    |
| student_id | INTEGER | Ссылка на студента                |
| meal_id    | INTEGER | Ссылка на прием пищи              |
| timestamp  | TEXT   | Время записи посещения            |
| status     | TEXT   | Статус ('came' или 'didnt_come')  |

## Описание модулей

### launcher.py
- `install_dependencies()`: Проверяет и устанавливает openpyxl при необходимости.
- `initialize_database()`: Вызывает init_db() для создания базы данных.
- `run_gui()`: Запускает GUI-приложение.
- `main()`: Основная функция лаунчера, выполняющая все шаги.

### gui.py
- `AttendanceSystemGUI`: Основной класс GUI-приложения на базе Tkinter.
  - `__init__()`: Инициализирует окно, вкладки и базу данных.
  - Методы для вкладки "Управление студентами": `load_students()`, `add_student_dialog()`, `edit_student_dialog()`, `delete_student()`, `import_students_from_xlsx()`.
  - Методы для вкладки "Регистрация": `find_student_for_registration()`, `load_meals_for_registration()`, `register_student()`.
  - Методы для вкладки "Отчеты": `load_meals_for_report()`, `generate_specific_report()`, `generate_all_report()`.
  - Методы для вкладки "Проверка посещаемости": `update_current_meal()`, `check_attendance()`.
- `main()`: Запускает GUI-приложение.

### view_reports.py
- Консольная версия генерации отчетов (альтернатива GUI).
- `show_attendance_for_meal()`: Отчет по конкретному приему пищи.
- `show_all_attendance()`: Общая таблица посещаемости.
- `main()`: Меню выбора типа отчета.

### db/init_db.py
- `init_db()`: Создает и инициализирует базу данных с необходимыми таблицами
- Заполняет таблицу meals стандартными приемами пищи для всех дней недели

### db/student.py
- `finding_card(card_id)`: Находит ID студента по ID карты
- `check_student(card_id, meal_id)`: Проверяет, зарегистрирован ли студент на прием пищи
- `log_attendance(student_id, meal_id, status)`: Записывает факт посещения
- `add_student(name, card_id)`: Добавляет нового студента
- `add_registration(student_id, meal_id)`: Регистрирует студента на прием пищи
- `get_all_students()`: Возвращает список всех студентов
- `update_student(student_id, name, card_id)`: Обновляет информацию о студенте
- `delete_student(student_id)`: Удаляет студента и связанные записи

### db/meals.py
- `get_current_meal()`: Определяет текущий прием пищи на основе времени и дня недели
- `get_meal_name(meal_id)`: Возвращает название приема пищи по ID

### db/reports.py
- `get_attendance_report(meal_id, day_of_week)`: Генерирует отчет по посещаемости для конкретного приема пищи
- `get_all_attendance_records()`: Возвращает все записи о посещаемости для формирования общей таблицы

## Замечания по разработке

### Добавление новых функций
- Все операции с базой данных вынесены в отдельные модули в папке `db/`
- Для добавления новых типов отчетов модифицируйте `db/reports.py`, `view_reports.py` и соответствующие методы в `gui.py`
- Для изменения логики проверки посещаемости редактируйте `main.py`, `db/student.py` и метод `check_attendance()` в `gui.py`
- Для расширения GUI добавляйте новые вкладки в `AttendanceSystemGUI.__init__()` и соответствующие методы
- Импорт из XLSX: Формат файла - начиная с строки 9, столбец C (3) - имя студента, столбцы D-AV (4-47) - регистрации (по 3 столбца на день: понедельник-суббота, завтрак/обед/ужин, значение 1 для регистрации). Можно расширить для поддержки других форматов в `import_students_from_xlsx()`

### Безопасность
- ID карт должны быть уникальными
- Включены внешние ключи для поддержания целостности данных
- Рекомендуется регулярное резервное копирование файла `skud.db`
- При импорте XLSX проверяйте источник файла на безопасность

### Расширение системы
Возможные улучшения:
- Веб-интерфейс для управления системой (альтернатива GUI)
- Интеграция с RFID-ридерами для автоматического считывания карт
- Экспорт отчетов в различные форматы (PDF, Excel) - добавить кнопки экспорта в вкладке "Отчеты"
- Темизация GUI (светлая/темная тема, кастомные цвета)
- Уведомления о пропусках приемов пищи (email/SMS интеграция)
- Статистика посещаемости по периодам (графики, диаграммы в GUI)
- Реальное время обновления данных в GUI (автообновление списков)
- Логирование действий пользователей для аудита
